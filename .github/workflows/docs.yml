name: Documentation Generator

on:
  push:
    branches: [main]
  workflow_dispatch:

env:
  NODE_VERSION: '18.x'

jobs:
  docs:
    name: 📚 Generate Documentation
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
      
    - name: 🔧 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        
    - name: 📦 Install dependencies
      run: npm install
      
    - name: 📚 Generate API documentation
      run: |
        echo "📚 Generating comprehensive documentation..."
        mkdir -p docs/api docs/guides docs/examples
        
        # Generate README sections
        echo "# Universal DB Migration Tool Documentation" > docs/README.md
        echo "" >> docs/README.md
        echo "## Quick Start" >> docs/README.md
        echo "\`\`\`bash" >> docs/README.md
        echo "# Install the tool" >> docs/README.md
        echo "npm install -g universal-db-migration-tool" >> docs/README.md
        echo "" >> docs/README.md
        echo "# Generate configuration" >> docs/README.md
        echo "npm start config-template mysql --output my-config.yaml" >> docs/README.md
        echo "" >> docs/README.md
        echo "# Run migration" >> docs/README.md
        echo "npm start migrate --config my-config.yaml" >> docs/README.md
        echo "\`\`\`" >> docs/README.md
        
        # Database provider documentation
        echo "## Supported Database Providers" >> docs/README.md
        echo "" >> docs/README.md
        echo "| Provider | Status | Version Support |" >> docs/README.md
        echo "|----------|--------|----------------|" >> docs/README.md
        echo "| MySQL | ✅ | 5.7+ |" >> docs/README.md
        echo "| PostgreSQL | ✅ | 10+ |" >> docs/README.md
        echo "| SQLite | ✅ | 3+ |" >> docs/README.md
        echo "| Microsoft SQL Server | ✅ | 2016+ |" >> docs/README.md
        echo "| Oracle Database | ✅ | 12c+ |" >> docs/README.md
        echo "| MongoDB | ✅ | 4.4+ |" >> docs/README.md
        
        cat docs/README.md
        
    - name: 🎯 Generate CLI documentation
      run: |
        echo "🎯 Generating CLI documentation..."
        echo "# CLI Reference" > docs/cli-reference.md
        echo "" >> docs/cli-reference.md
        echo "## Available Commands" >> docs/cli-reference.md
        echo "" >> docs/cli-reference.md
        echo "### \`providers\`" >> docs/cli-reference.md
        echo "List all supported database providers" >> docs/cli-reference.md
        echo "" >> docs/cli-reference.md
        echo "### \`config-template <provider>\`" >> docs/cli-reference.md
        echo "Generate configuration template for specified provider" >> docs/cli-reference.md
        echo "" >> docs/cli-reference.md
        echo "### \`migrate --config <file>\`" >> docs/cli-reference.md
        echo "Execute database migration using specified configuration" >> docs/cli-reference.md
        
    - name: 📝 Generate configuration examples
      run: |
        echo "📝 Generating configuration examples..."
        npm start config-template mysql --output docs/examples/mysql-config.yaml
        npm start config-template postgresql --output docs/examples/postgresql-config.yaml
        npm start config-template mongodb --output docs/examples/mongodb-config.yaml
        
        ls -la docs/examples/
        
    - name: 🔍 Generate feature documentation
      run: |
        echo "🔍 Generating feature documentation..."
        echo "# Key Features" > docs/features.md
        echo "" >> docs/features.md
        echo "## 🚫 Zero External Dependencies" >> docs/features.md
        echo "This tool is completely library-free and uses only:" >> docs/features.md
        echo "- Built-in Node.js modules" >> docs/features.md
        echo "- Custom YAML parser" >> docs/features.md
        echo "- Custom CLI parser" >> docs/features.md
        echo "- Database-specific drivers only" >> docs/features.md
        echo "" >> docs/features.md
        echo "## 🔌 Database Provider Independence" >> docs/features.md
        echo "Supports 6 major database providers with unified interface:" >> docs/features.md
        echo "- SQL databases: MySQL, PostgreSQL, SQLite, MSSQL, Oracle" >> docs/features.md
        echo "- NoSQL databases: MongoDB" >> docs/features.md
        
    - name: 📤 Upload documentation artifacts
      uses: actions/upload-artifact@v4
      with:
        name: documentation
        path: docs/
        
    - name: 📊 Documentation summary
      run: |
        echo "📊 Documentation generation complete!"
        echo "Generated files:"
        find docs/ -type f -name "*.md" -o -name "*.yaml" | head -20